<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 11/02/2016 11:41:25 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>uispec4j - 
    Intercepting dialogs and windows</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20160211" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                
                </div>
                              <a href="http://uispec4j.org/" id="bannerRight">
                                                <img src="uispec4j.png" alt="UISpec4J" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 11/02/2016 11:41:25</span>
                  &nbsp;| <span id="projectVersion">Version: 2.5-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="index.html" title="Home">Home</a>
            |
                        <a href="http://www.junit.org" class="externalLink" title="JUnit">JUnit</a>
            |
                        <a href="http://www.extremeprogramming.org" class="externalLink" title="Extreme Programming">Extreme Programming</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="goals.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
                          <a href="features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="example.html" title="Example">Example</a>
            </li>
                  <li class="none">
                          <a href="gettingstarted.html" title="Getting started">Getting started</a>
            </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="contact.html" title="Contact">Contact</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                          <a href="apidocs/index.html" title="Javadoc API specification">Javadoc API specification</a>
            </li>
                  <li class="none">
                          <a href="findingcomponents.html" title="Finding components">Finding components</a>
            </li>
                  <li class="none">
                          <a href="assertions.html" title="Using assertions">Using assertions</a>
            </li>
                  <li class="none">
            <strong>Intercepting windows</strong>
          </li>
                  <li class="none">
                          <a href="popupmenus.html" title="Intercepting pop-up menus">Intercepting pop-up menus</a>
            </li>
                  <li class="none">
                          <a href="usingcolors.html" title="Using colors">Using colors</a>
            </li>
                  <li class="none">
                          <a href="extension.html" title="Extending UISpec4J">Extending UISpec4J</a>
            </li>
                  <li class="none">
                          <a href="properties.html" title="Properties">Properties</a>
            </li>
                  <li class="none">
                          <a href="troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
          </ul>
                       <h5>Developers</h5>
                  <ul>
                  <li class="none">
                          <a href="contributing.html" title="Contributing">Contributing</a>
            </li>
                  <li class="none">
                          <a href="developing.html" title="Checkout & build">Checkout & build</a>
            </li>
                  <li class="none">
                          <a href="codingrules.html" title="Coding rules">Coding rules</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                                     <a href="http://www.crossbowlabs.com/" title="CrossbowLabs" class="poweredBy">
        <img class="poweredBy"  alt="CrossbowLabs" src="images/logos/poweredbycrossbowlabs.jpg"     />
      </a>
                       
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
    <div class="section">
<h2>Intercepting popped-up dialogs and windows<a name="Intercepting_popped-up_dialogs_and_windows"></a></h2>
      
<p>UISpec4J provides a mechanism for detecting dialog or popups displayed by the
        application, without requiring any change in the production code. This mechanism relies
        on the Swing Look&amp;Feel classes, especially those evolving around the Toolkit and Peer
        interfaces.</p>
      
<p>The trick is to provide our own Toolkit implementation,
        which instantiates Peer components that intercept calls to dialog and popup &quot;show()&quot;
        methods and trigger the UISpec4J code instead of displaying them on the screen.
      </p>

      
<div class="section">
<h3>Setting up the interception mechanism<a name="Setting_up_the_interception_mechanism"></a></h3></div>
      
<p>
        In order to enable the interception mechanism, you will need to call the
        <a href="apidocs/org/uispec4j/UISpec4J.html#init">UISpec4J.init()</a>
        method <i>before any Swing component gets instanciated</i>
        - if init() is called too late, the Swing default toolkit will have already been
        set up and the interception will not work.
      </p>
      
<p>A typical way to achieve that is to call this method from within a static initializer in
        your test class or any of its ancestors. For instance, you can create a superclass for
        all your test classes where you will add the following initializer: </p>
      
<div class="source">
<pre>
  public abstract class MyOwnTestCase extends TestCase {
    static {
        UISpec4J.init();
    } ...
      </pre></div>
      
<p>
        You can also use the
        <a href="apidocs/org/uispec4j/UISpecTestCase.html">UISpecTestCase</a> base class, which
        implements this initialization.
      </p>

      
<div class="section">
<h3>Intercepting windows<a name="Intercepting_windows"></a></h3>
      
<p>The
        <a href="apidocs/org/uispec4j/interception/WindowInterceptor.html">WindowInterceptor</a>
        class is used for intercepting popped-up frames and dialogs.
        Non-modal windows are retrieved using the following code construct:
      </p>
      
<div class="source">
<pre>
  Window window = WindowInterceptor.run(new Trigger() {
    public void run() {
      ...trigger an action that causes the window to be shown...
    }
  });
      </pre></div>
      
<p>
        Most UISpec4J components provide &quot;trigger&quot; methods that return ready-to-use triggers, for instance:
      </p>
      
<div class="source">
<pre>
  Window window = WindowInterceptor.run(panel.getButton(&quot;Show&quot;).triggerClick());
      </pre></div>
      
<p>or</p>
      
<div class="source">
<pre>
  Window window = WindowInterceptor.run(menuBar.getMenu(&quot;File&quot;).getSubMenu(&quot;Open&quot;).triggerClick());
      </pre></div>
      
<p>
        This mechanism is also used for intercepting the main window of your application. For instance,
        you could simply invoke your application's main() from within the trigger:
      </p>
      
<div class="source">
<pre>
  Window appWindow = WindowInterceptor.run(new Trigger() {
    public void run() {
      MyApplication.main(new String[0]);
    }
  });
      </pre></div>
      
<p>
        NB: All shown windows must be declared in the tests using WindowInterceptor calls. If the
        application code tries to display an unexpected window from outside a WindowInterceptor call,
        it will receive an exception raised by the toolkit and the test will fail.
      </p>
      </div>

      
<div class="section">
<h3>Intercepting modal dialogs<a name="Intercepting_modal_dialogs"></a></h3>
      
<p>
        Modal dialogs are more difficult to handle than their non-modal counterparts, because
        the application code is blocked while the dialog is being shown, waiting for a result.
      </p>
      
<p>
        To manage this, the WindowInterceptor class provides a means for registering a set of handlers
        that will be executed within the context of the dialog:
      </p>
        
<div class="source">
<pre>
    WindowInterceptor
      .init(applyButton.triggerClick())
      .process(new WindowHandler() {
        public Trigger process(Window window) {
          // ... perform some operations on the shown window ...
          return window.getButton(&quot;OK&quot;).triggerClick(); // return a trigger that will close it
        }
      })
      .run();
        </pre></div>
        
<p>
          This approach involves three steps:
          </p>
<ol style="list-style-type: decimal">
            
<li>The interception is started with a
              <a href="apidocs/org/uispec4j/Trigger.html">Trigger</a>.
              As for non-modal windows, it is responsible for triggering the display of the dialog.
            </li>
            
<li>
              The
              <a href="apidocs/org/uispec4j/interception/WindowHandler.html">WindowHandler</a>
              provided to the WindowInterceptor.process() method is given the shown window in its process()
              call. The body of this method is responsible for dealing with that window, and then
              returning a trigger that will close it. In our example we return a trigger that will click
              on the &quot;OK&quot; button displayed in the dialog.
            </li>
            
<li>
              The interception is actually started only when the run() method is called.
            </li>
          </ol>
        
        
<p>
          The step 2 above can be repeated to handle a sequence of dialogs. For instance, if the use case
          being tested involves two consecutive windows, we will write something like:
        </p>
        
<div class="source">
<pre>
    WindowInterceptor
      .init(applyButton.triggerClick())
      .process(new WindowHandler(&quot;first dialog&quot;) {
        public Trigger process(Window window) {
          // ... perform some operations on the first window ...
          return window.getButton(&quot;OK&quot;).triggerClick(); // return a trigger that will close it
        }
      })
      .process(new WindowHandler(&quot;second dialog&quot;) {
        public Trigger process(Window window) {
          // ... perform some operations on the second window ...
          return window.getButton(&quot;OK&quot;).triggerClick(); // return a trigger that will close it
        }
      })
      .run();
        </pre></div>
      </div>

      
<div class="section">
<h3>Built-in window handlers<a name="Built-in_window_handlers"></a></h3>
        
<p>
          The <a href="apidocs/org/uispec4j/interception/WindowInterceptor.html">WindowInterceptor</a>
          class provides a number of utility methods for handling dialogs with a simple button click,
          or just waiting for a transient progress window to close itself.
          Please refer to the Javadoc of this class for more information.
        </p>
        
<p>
          Many dialogs in an application are simply confirmation or input dialogs.
          To cover these cases, we provide a
          <a href="apidocs/org/uispec4j/interception/BasicHandler.html">BasicHandler</a> class
          that will let you input text and press buttons in your dialogs without needing to write
          inner classes.

          For instance, a dialog simply asking for entering your first name could be handled like this:

    WindowInterceptor
      .init(applyButton.triggerClick())
      .process(BasicHandler.init()
        .assertContainsText(&quot;Enter your first name:&quot;)
        .setText(&quot;John&quot;)
        .triggerButtonClick(&quot;OK&quot;))
      .run();

        </p>
        
<p>A specific WindowHandler implementation is available for file choosers: the
          <a href="apidocs/org/uispec4j/interception/FileChooserHandler.html">FileChooserHandler</a>
          class. Please refer to the Javadoc of this class for more information.
        </p>
      </div>

      
<div class="section">
<h3>Custom window handlers<a name="Custom_window_handlers"></a></h3>
        
<p>
          In order to keep your tests as simple as possible, we suggest that you develop your
          own window handler classes for the most frequently used dialogs in your application.
          This will avoid a proliferation of complex inner class definitions in your tests, and
          keep your test code more compact.
        </p>
      </div>

    </div>

  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2004-2016.
          All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
